<div data-dojo-type = "dijit.form.Form" 
     id             = "newPhoneAddForm" 
     data-dojo-id   = "newPhoneAddForm"
     encType        = "multipart/form-data" 
     action         = "" 
     method         = "">

    <script type="dojo/method" data-dojo-event="onReset">
        return true;
    </script>

    <script type="dojo/method" data-dojo-event="onSubmit">
     if(this.validate()){
      require(["dojo/_base/xhr", 
               "dojo/dom", 
               "dojo/json", 
               "dijit/registry", 
               "dijit/Dialog",
               "dojo/domReady!"
      ],
      function(xhr, dom, JSON, registry, Dialog){
 							var hasBeenSent = false;
//{% if perms.patient.add_patientphone %}
							xhr.post({
									url  : "{{patient_detail_obj.get_patient_phone_add_url}}" ,
									form : dom.byId("newPhoneAddForm"),
									load : function(json) {
											var jsondata = JSON.parse(json)
											if(jsondata.success = true){
												dom.byId("newPhoneAddForm").reset();
												if(ADD_MORE_PATIENT_PHONE == false){
												 dijit.byId("editPatientDialog").hide();
												}
												else{
												  dijit.byId("id_phone_type").focus();
												}
												var data = {'id'         : jsondata.id, 
																	 'phone_type'  : jsondata.phone_type,
																	 'ISD_Code'    : jsondata.ISD_Code,
																	 'STD_Code'    : jsondata.STD_Code,
																	 'phone'       : jsondata.phone,
																	 'edit'        : jsondata.edit,
																	 'del'         : jsondata.del,
												}
												phoneGrid.store.newItem(data);
											}
											else{
												var content = jsondata.error_message + "\n" + jsondata.form_errors;
									      dijit.byId('dialogJsonMessage').set('title',"ERROR!");
									      dijit.byId('dialogJsonMessage').set('content',content);
									      dijit.byId("dialogJsonMessage").show();
											}
									},
									error: function(json) {
									    var jsondata = JSON.parse(json);
								      dijit.byId('dialogJsonMessage').set('title',"ERROR!");
	  						      dijit.byId('dialogJsonMessage').set('content',jsondata.error_message);
  							      dijit.byId("dialogJsonMessage").show();
									},
									handle: function() {
											hasBeenSent = true;
									}
							});
//{% else %}							
   dijit.byId('permissionDeniedErrorDialog').show();
   return false;
//{% endif %}   
     });
    return false;
    }
    else{
     dijit.byId("invalidFormSubmissionErrorDialog").show();
     return false;
    }
  </script>

{% if perms.patient and perms.patient.add_patientphone %}
		<table>
			{{patient_phone_add_form}}
		</table>

		<button 	type 	          = "submit" 
						  data-dojo-type  = "dijit.form.Button"
						  data-dojo-props = "iconClass:'dijitIconSave'"
					   	name 	          = "submitbutton" 
						  id 		          = "patient_phone_add_form_submit"
						  value           = "Add">
		 Add
		 <script type="dojo/connect" data-dojo-event="onClick" data-dojo-args="evt">
		   ADD_MORE_PATIENT_PHONE = false;
		 </script>
		</button>

		<button 	type 	          = "submit" 
						  data-dojo-type  = "dijit.form.Button"
						  data-dojo-props = "iconClass:'dijitIconSave'"
					   	name 	          = "submitAndAddMoreButton" 
						  id 		          = "patient_phone_add_form_add_more"
						  value           = "Add More">
		 Add More
		 <script type="dojo/connect" data-dojo-event="onClick" data-dojo-args="evt">
		   ADD_MORE_PATIENT_PHONE = true;
		 </script>
		</button>

		<button 	type 	          = "reset" 
						  data-dojo-type  = "dijit.form.Button"
						  data-dojo-props = "iconClass:'dijitIconClear'"
						  id 		          = "patient_phone_add_form_reset"
						  value           = "Reset">
		 Reset
		</button>
{% else  %}
  <p class="suggestion_text"> Insufficient Permissions to add </p>
{% endif %}

</div>
