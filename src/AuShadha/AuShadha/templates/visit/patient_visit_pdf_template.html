<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
    "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>

<style type="text/css">
     @page {
            size: a4 portrait;
            margin: 1.0in 0.25in 0.5in 0.25in;
            padding: 0;
            background-image: url("{{STATIC_URL}}images/AuShadha_logo/AuShadha_logo_128.png");

            @frame header {
                -pdf-frame-content: headerContent;
                width: 8in;
                top: 0.5in;
                margin-left: 0.5in;
                margin-right: 0.5in;
                margin-bottom: 0.5in;
                height: 1.0in;
                background:#ddd;
            }
            @frame footer {
                -pdf-frame-content: footerContent;
                width: 8in;
                bottom: 0in;
                margin-left: 2cm;
                margin-right: 2cm;
                height: 1cm;
                background:#ddd;
            }
            h1,h2,h3,h4,h5,h6{
             -pdf-outline:true;
             -pdf-open:false;
            }
    }
            pdftoc {
                color: #666;
            }
            pdftoc.pdftoclevel0 {
                font-weight: bold;
                margin-top: 0.5em;
            }
            pdftoc.pdftoclevel1 {
                margin-left: 1em;
            }
            pdftoc.pdftoclevel2 {
                margin-left: 2em;
                font-style: italic;
            } 

</style>

</head>

<body>

  <div id='headerContent' style="font-size:8px; font-style:italic;">
      Visit Report for : {{patient_detail_obj}} generated by {{user.username}} on {% now "jS F Y H:i" %}
      <hr>
  </div>

  <div> 
    <pdf:toc/> 
  </div>


  <div> 
    <hr>
      <h1> Visit Report for {{patient_detail_obj}} </h1>
    <hr>
  </div>


  <div>

    {%if visit_obj_list %}
    <h2> Visits </h2> 

      {% for visit_obj in visit_obj_list %}

        {% for visit_detail, visit_rel in visit_obj.iteritems %}

          <div id              = "visitSummaryPDFTemplateDiv_{{visit_detail.id}}"
               class           = "visitSummaryPDFTemplateDiv

                                  {%if visit_detail.is_active%}
                                     visit_isActive
                                  {%else%}
                                     visit_isNotActive
                                  {%endif%}

                                  visitStatus_{{visit_detail.status}}
                                  visitNature_{{visit_detail.consult_nature}}

                                  {% if visit_detail.get_visit_complaints%}
                                    {% for visitComplaint in visit_detail.get_visit_complaints%}
                                      visitComplaint_{{visitComplaint.complaint}}
                                    {%endfor%}
                                  {%endif%}

                                  {% if visit_detail.has_fu_visits %}
                                    visit_hasFu
                                  {%else%}
                                    visit_hasNoFu
                                  {%endif%}
                                  
                                  visitOPSurgeon_{{visit_detail.op_surgeon}}
                                  "
               >
            <div>
              <h3>
                  Date : {{visit_detail.visit_date.date}}  - {{visit_detail.op_surgeon}}
              </h3>
              <p> {{visit_detail.visit_nature}} ( {{visit_detail.visit_status}} ) </p>
              {% if visit_detail.remarks != 'NAD' %}
                <p style="font-weight: bold;">
                  Remarks:
                </p>  
                <p style="padding-left : 15px; 
                          line-height  : 1.6em; 
                          text-align   : justify;
                          ">
                    {{visit_detail.remarks.capitalize}} 
                </p>
              {% endif %}
            </div>

            <div> 
              {% for obj, obj_list in visit_rel.iteritems %}
                <table>
                    <thead>
                      <tr>
                        <th style="font-weight : bold; 
                                   text-align  : left;"> {{obj.upper}}</th> 
                      </tr>
                    </thead>
                    <tbody>
                    <tr>
                      <td style="padding-left : 15px; 
                                line-height   : 1.6em; 
                                text-align    : left;
                                ">
                        {% for item in obj_list %}
                              {{item}}
                        {% endfor %}
                      </td>
                    </tr>
                    </tbody>
                </table>
              {% endfor %}
            </div>

            {% if visit_detail.has_fu_visits %}
              <h4 style="font-weight : bold; 
                          background   : #fff; 
                          width        : 100%; 
                          text-align   : center;
                          "> 
                Follow Ups 
              </h4>
              {% for fu in visit_detail.has_fu_visits %}
                <div class = "follow_up" 
                     style = "background    : white; 
                              border        : solid 1px #aaa; 
                              border-radius : 5px; 
                              position      : relative; 
                              left          : .4em;
                              padding       : .2em;
                              margin        : .2em;
                              line-height   : 2.1em;
                              word-wrap     : break-word;
                              white-space   : pre-line;
                              "
                   >

                      {{fu.formatted_obj|safe}}  
                </div>
              {% endfor %}
            {% endif %}
          </div>
<!--           <hr class="shadow_line"> -->
      {% endfor %}

      {% comment %}
      <div style="float:right;"> 
        XXX<pdf:barcode/>
      </div>
      {% endcomment %}

      <div id="footerContent"  style="font-size:8px; font-style:italic; text-align:right;"> 
        <hr>
        Report Generated on {% now "jS F Y H:i" %} by {{user.username}} 
        <div> Page No. 00<pdf:pagenumber> </div>
      </div>

      <div>
        <pdf:nextpage />
      </div> 

    {% endfor %}

    {% else %}
      <h2> No OPD visits recorded for this Patient </h2>
      <hr>      
    {% endif %}

  </div>


</body>
</html>
