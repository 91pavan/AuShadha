
<div id              = "simplePatientSearch"
 >
<!--    <img src   = "{{MEDIA_URL}}images/search.png" -->
<!--         alt   = "Search" -->
<!--         title = "Search"-->
<!--         id    = patSearchIcon-->
<!--         style = "//position : relative; -->
<!--                  //top      : -50px; -->
<!--                  //left     : -30px;-->
<!--                  margin   : -30px;-->
<!--                  //padding  : 0px;-->
<!--                  z-index  : 10;-->
<!--                  display  : none;-->
<!--                 ">-->

    <div data-dojo-type  = "dojo/store/Memory"
         data-dojo-id    = "patSearchForStore"
         data-dojo-props = "data: [
                                  {id: 'full_name'  , name: 'Full Name' }, 
                                  {id: 'first_name' , name: 'First Name' }, 
                                  {id: 'middle_name',  name: 'Middle Name'},
                                  {id: 'last_name'  ,  name: 'Last Name'  },
                                  {id: 'age'        , name: 'Age'  },
                                  {id: 'sex'        , name: 'Sex'  },
                                  {id: 'patient_hospital_id'   , name: 'Hospital ID'  }
                                  {% if user.is_superuser %}
                                  ,{id: 'id' , name: 'Primary Key' }
                                  {% endif %}
                                 ]">
    </div>

    <!--<div data-dojo-type  = "dijit.Tooltip" -->
    <!--     data-dojo-props = "connectId:'patientGridFilterBtn',position:['above']">-->
    <!--     Enter Search terms and click to search for a Patient-->
    <!--</div>-->

    <div data-dojo-type   = "dijit/form/FilteringSelect"
         class            = "search_form_div"
         value            = "full_name"
         data-dojo-props  = "store:patSearchForStore, required:true, searchAttr:'name'"
         name             = "patSearchForFilteringSelect"
         data-dojo-id     = "patSearchForFilteringSelect"
         id               = "patSearchForFilteringSelect"
         onChange         = "patSearchForFilteringSelectOnChange(this.get('value'))"
     >

    </div>

    <div id    = "searchLinker" 
         class            = "search_form_div"
         style = "font-style : italic; 
                  color      : navy  ; 
                  text-align : left;
                 ">  
      contains ..
    </div>

    <div  data-dojo-type  = "dijit/form/ValidationTextBox" 
         class            = "search_form_div"
          data-dojo-id    = "filterPatGridTextBox"
          data-dojo-props = "regExp         : '[a-zA-Z0-9 -]+', 
                             required       : true,
                             invalidMessage : 'Invalid Search Terms'
                            "
          id              = "filterPatGridTextBox"
          onKeyUp         = "patSearchOnKeyUp('evt');"
     >

    </div>

    <button data-dojo-type  = "dijit/form/Button" 
         class            = "search_form_div"
            data-dojo-props = "iconClass: 'dijitIconFilter'"
            type            = "submit"
            data-dojo-id    = "patientGridFilterBtn"
            id              = "patientGridFilterBtn"
            title           = "Search For Patients based on criteria"
    >
      Filter
      <script type             = "dojo/connect" 
              data-dojo-event  = "onClick" 
              data-dojo-args   = "evt"
      >
          var search_field   = patSearchForFilteringSelect.get('value');
          var txt            = filterPatGridTextBox.get('value');
          var search_obj     = { search_field : search_field , 
                                 search_for    : txt 
                                };
          if( !filterPatGridTextBox.get('value') || 
              !patSearchForFilteringSelect.get('value') 
          ){
            search_obj.search_for   = "*"
            search_obj.search_field = "id"
          }
          grid.filter(search_obj, true);
      </script>

    </button>

    <button data-dojo-type  = "dijit/form/Button" 
         class            = "search_form_div"
            data-dojo-props = "iconClass: 'dijitIconClear'"
            type            = "submit"
            data-dojo-id    = "patientGridFilterClearBtn"
            id              = "patientGridFilterClearBtn"
            title           = "Clear Filter"
    >
      Clear
      <script type             = "dojo/connect" 
              data-dojo-event  = "onClick" 
              data-dojo-args   = "evt"
      >
          patSearchForFilteringSelect.set('displayedValue', "Full Name");
          filterPatGridTextBox.set('displayedValue', "");
          var search_obj     = { search_field : "id" , search_for : "*" };
          grid.filter(search_obj, true);
      </script>

    </button>
</div>


<div data-dojo-type  = "dijit/TitlePane" 
     data-dojo-props = "title: 'Advanced Search', open:false"
     id              = "advancedPatSearchDiv"
     style           = "padding :1px 20px 1px 20px;"
>
<form data-dojo-type= "dijit/form/Form"
      data-dojo-id  = "patient_advanced_search_form"
      id            = "patient_advanced_search_form"
      encType       = "multipart/form-data" 
      action        = ""
      method        = ""
 >

  <script type="dojo/method" data-dojo-event="onReset">
      return true;
  </script>

  <script type="dojo/method" data-dojo-event="onSubmit">
   if(this.validate()){
    require(["dojo/_base/xhr", 
             "dojo/dom", 
             "dojo/json", 
             "dijit/registry", 
             "dijit/Dialog",
             "dojo/domReady!"
    ],
    function(xhr, dom, JSON, registry, Dialog){
						var hasBeenSent = false;
						xhr.post({
								url  : "{%url patient_search %}",
								form : dom.byId("patient_search_form"),
								load : function(json) {
										var jsondata = JSON.parse(json)
										if(jsondata.success = true){
											dom.byId("patient_search_form").reset();
                      editDialog.hide()
											var data = {}
										}
										else{
											var content = jsondata.error_message + "\n" + jsondata.form_errors;
                      errorDialog.set('content', content);
                      errorDialog.set('title', "ERROR! ");
								      errorDialog.show();
										}
								},
								error: function(response) {
                      errorDialog.set('content', jsondata.error_message);
                      errorDialog.set('title', "ERROR! ");
								      errorDialog.show();
								},
								handle: function() {
										hasBeenSent = true;
								}
						});
						
   });
		return false;
		}
		else{
		 return false;
		}
  </script>

<!--<img src   = "{{MEDIA_URL}}images/search.png" -->
<!--     alt   = "Search" -->
<!--     title = "Search"-->
<!--     style = "position : relative; -->
<!--              top      : -50px; -->
<!--              left     : -30px;-->
<!--              margin   : -30px;-->
<!--              padding  : 0px;-->
<!--              z-index  : 10;-->
<!--             ">-->
   <table>

<!--      <tr>-->
<!--        <td>-->
<!--          <label for="patientHospitalIdSelection"-->
<!--                 style="margin-left: 0px; float:left;"-->
<!--          > -->
<!--            Id -->
<!--          </label>-->
<!--          <div id="patientHospitalIdSelection"-->
<!--               style="margin-left: 0px; float:left;"-->
<!--          > </div>-->
<!--        </td>-->
<!--      </tr>-->

<!--      <tr>-->
<!--        <td>-->
<!--          <label for="patientNameSelection"-->
<!--                 style="margin-left: 0px; float:left;"-->
<!--          > -->
<!--            Name -->
<!--          </label>-->
<!--          <div id="patientNameSelection"-->
<!--                style="margin-left: 0px; float:left;"-->
<!--          > </div>-->
<!--        </td>-->
<!--      </tr>-->

<!--      <tr>-->
<!--        <td>-->
<!--          <label for="patientAgeTextBox"-->
<!--                 style="margin-left: 0px; float:left;"-->
<!--          > -->
<!--            Age-->
<!--          </label>-->
<!--          <input type            = "text"  -->
<!--                 id              = "patientAgeTextBox"-->
<!--                 data-dojo-type  = "dijit/form/ValidationTextBox"-->
<!--                 data-dojo-props = "readOnly:true"-->
<!--                 style           = "width: 40px;"-->
<!--           > -->
<!--        </td>-->

<!--        <td>-->
<!--          <label for="patientSexTextBox"-->
<!--                 style="margin-left: 0px;"-->
<!--          > -->
<!--            Sex -->
<!--          </label>-->
<!--          <input id              = "patientSexTextBox"-->
<!--                 data-dojo-type  = "dijit/form/ValidationTextBox"-->
<!--                 data-dojo-props = "readOnly:true"-->
<!--                 style           = "width: 40px;"-->
<!--          >-->
<!--        </td>-->
<!--      </tr>-->

      <tr>
        <td>
          <label for="patientSurgeonFilteringSelect"
                 style="margin-left: 0px; float:left;"
          > 
            Surgeon
          </label>
          <input type           = "text" 
                 id             = "patientSurgeonFilteringSelect"
                 data-dojo-type = "dijit/form/FilteringSelect"
          >
        </td>
      </tr>

      <tr>
        <td>
          <label for="patientCityTextBox"
                 style="margin-left: 0px; float:left;"
          > 
            City 
          </label>
          <input id              = "patientCityTextBox"
                 data-dojo-type  = "dijit/form/ValidationTextBox"
                 data-dojo-props = "readOnly:true"
          >
        </td>
      </tr>

      <tr>
        <td>
		      <button 
            type            = "submit"
			      data-dojo-props ="iconClass: 'dijitIconSearch'"
		        data-dojo-type  = "dijit/form/Button"
		        id              = "patientAdvancedSearchFormSubmitBtn" 
 						data-dojo-id    = "patientAdvancedSearchFormSubmitBtn"
		      > 
		         Search
		      </button>

					<button data-dojo-type  = "dijit/form/Button" 
						      data-dojo-props ="iconClass: 'dijitIconClear'"
						      type            = "reset"
					        data-dojo-id    = "patientAdvancedSearchFormResetBtn"
					>
						 Reset
					</button>

	      </td>
      </tr>
   </table>
</form>

</div>

