<script type="dojo/method" data-dojo-event="onSubmit">
  
    if( this.validate() ) {

      require(["dojo/dom",
               "dojo/query",
               "dojo/dom-attr",
              "dojo/request/xhr",
              "dijit/registry"  ,
              "dojo/json"       ,
              "dojo/dom-form"   ,
              "dijit/Dialog",
              "dojo/NodeList-traverse",
              "dojo/NodeList-data"
      ],
      
      function( dom, query, domAttr, xhr, registry, JSON, domForm, Dialog ) {
        
        xhr("{{visit_detail_obj.urls.edit}}",
            {handleAs: "text",
              method  : "POST",
              data    : domForm.toObject("newVisitEditForm_{{visit_detail_obj.id}}")
            }
        ).then(

          function( json ){
              var jsondata = JSON.parse( json );
              var parentTab = registry.byId('opd_visits_center_summary_tab').getParent();
              var editTab = query("#newVisitEditForm_{{visit_detail_obj.id}}").parent('.subTabContainer')[0];
              editTab = registry.byId(domAttr.get(editTab, 'id'))

              if( jsondata.success == true ){
                publishInfo( jsondata.error_message );
                registry.byId('opd_visits_center_summary_tab').set('href',CHOSEN_PATIENT.urls.summary.visit);
                registry.byId('opd_visits_leading_tree').refresh();
                parentTab.removeChild( editTab );
                editTab.destroyRecursive();
              }

              else{
                publishError("ERROR ! :" + jsondata.error_message );
              }
          },

          function( json ){
                var jsondata = JSON.parse( json ); 
                publishError("ERROR!: "+ jsondata.error_message );
          },

          function( evt ){
              console.log("Edited Visit Successfully...")
          }

        );
      });

      return false;

    }

    else{
      return false;
    }

</script>

